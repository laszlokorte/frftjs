<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Fractional Fourier Transform</title>
	<style>
		canvas {
			max-width: 100vw;
			width: 100%;
			object-fit: contain;
			object-position: center;
			display: block;
			height: 256px;
		}

		label {
			display: block;
		}
	</style>
</head>
<body>

	<fieldset>
		<legend>Options</legend>


		<label>
			Signal: <output id="signal_out"></output><br>
			<select onchange="changeSignal(this.value)" id="signal" name="signal">
				<option>rect</option>
				<option>sin</option>
				<option>dirac</option>
			</select>
		</label>

		<label>
			Fraction: <output id="fraction_out"></output><br>
			<input oninput="changeFrac(this.valueAsNumber)" value="0" type="range" min="0" max="4" step="0.01" name="fraction" id="fraction">
		</label>
	</fieldset>

	<canvas width="1024" height="256"></canvas>

	<script src="index.js"></script>
	<script>


		function makeSignal(type, length) {
			return {
				rect: () => fftShift(Array(length).fill(null).map((_,i)=> i<20||i>length-20 ? [1,0] : [0,0])),
				sin: () => fftShift(Array(length).fill(null).map((_,i)=> [Math.sin(i* Math.PI*2/length*20), 0])),
				dirac: () => fftShift(Array(length).fill(null).map((_,i)=> i == 0 ? [1, 0] : [0,0])),
			}[type]();
		}
	</script>
	<script>
		let scale = 1
		const canvas = document.getElementsByTagName('canvas')[0];
		const cH = canvas.height
		const cW = canvas.width
		const yAxisHeight = 1/4 * cH - 10
		const fraction_slider = document.getElementById('fraction');
		const fraction_out = document.getElementById('fraction_out');
		const signal_type = document.getElementById('signal');
		const signal_out = document.getElementById('signal_out');
		let signal = null
		let transformed = null
		changeSignal(signal_type.value)
		changeFrac(fraction_slider.valueAsNumber)

		function changeSignal(type) {
			signal = makeSignal(type, cW)
			changeFrac(fraction_slider.valueAsNumber)
		}

		function changeFrac(f) {
			transformed = fftShift(frft(fftShift(signal), f))
			scale = 1/Math.max(...transformed.map(([a,b]) => Math.max(a,b)))
			fraction_out.value = f
		}

		function render() {
			const ctx = canvas.getContext("2d");
			ctx.clearRect(0,0,cW,cH)

			ctx.save()
			ctx.translate(0,1/4 * cH)
			ctx.scale(1,-1);
			ctx.beginPath()
			ctx.fillStyle = "red";
			for(let t=0;t<signal.length;t++) {
				ctx.rect(t-1,yAxisHeight*signal[t][0]-1,2,2);
			}
			ctx.fill()
			ctx.beginPath()
			ctx.fillStyle = "blue";
			for(let t=0;t<signal.length;t++) {
				ctx.rect(t-1,yAxisHeight*signal[t][1]-1,2,2);
			}
			ctx.fill()
			ctx.restore()

			ctx.save()
			ctx.beginPath()
			ctx.fillStyle = "red";
			ctx.translate(0,3/4*cH)
			ctx.scale(1,-1);
			ctx.fillStyle = "red";
			for(let t=0;t<transformed.length;t++) {
				ctx.rect(t-1,scale*yAxisHeight*transformed[t][0]-1,2,2);
			}
			ctx.fill()
			ctx.beginPath()
			ctx.fillStyle = "blue";
			for(let t=0;t<transformed.length;t++) {
				ctx.rect(t-1,scale*yAxisHeight*transformed[t][1]-1,2,2);
			}
			ctx.fill()
			ctx.restore()
		}

		function tick() {
			render()
			window.requestAnimationFrame(tick)
		}

		function complAbs(a) {
			return Math.sqrt(a[0]*a[0] + a[1]*a[1])
		}

		tick()
	</script>

</body>
</html>